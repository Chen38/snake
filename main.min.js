var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Bug=function(e){function t(){var t=e.call(this)||this;return t.bugColor=16777215,t.bugSize=12,t}return __extends(t,e),t.prototype.generate=function(e,t){this.x=e,this.y=t,this.graphics.beginFill(this.bugColor),this.graphics.drawRect(0,0,this.bugSize,this.bugSize),this.graphics.endFill()},t}(egret.Shape);__reflect(Bug.prototype,"Bug");var Main=function(e){function t(){var t=e.call(this)||this;return t.currentSnakeMoveDirection=MoveDirection.UP,t.speedControlThreshold=5,t.isSnakeDead=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){var t=this,i=0;egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){i++,i>=t.speedControlThreshold&&(t.snakeGo(),i=0)}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.canvasWidth=this.stage.stageWidth,this.canvasHeight=this.stage.stageHeight,this.generateBg(),this.generateSnake(),this.randomGenerateFood(),this.generateDieWindow(),this.controlSnakeMove()},t.prototype.generateBg=function(){var e=new egret.Shape;e.graphics.beginFill(0),e.graphics.drawRect(0,0,this.canvasWidth,this.canvasHeight),e.graphics.endFill(),this.addChild(e)},t.prototype.randomGenerateFood=function(){this.bug&&(this.removeChild(this.bug),this.bug=null),this.bug=new Bug;var e=12*Math.floor(Math.random()*(this.canvasWidth-12)/12),t=12*Math.floor(Math.random()*(this.canvasHeight-12)/12);this.bug.generate(e,t),this.addChild(this.bug)},t.prototype.generateSnake=function(){this.snake=new Snake,this.snake.x=0,this.snake.y=0,this.snake.width=this.canvasWidth,this.snake.height=this.canvasHeight,this.addChild(this.snake)},t.prototype.controlSnakeMove=function(){var e=this,t=null;document.body.addEventListener("keydown",function(i){e.removeChild(e.snake);var n=i.keyCode;switch(n){case 38:case 87:e.currentSnakeMoveDirection=MoveDirection.UP;break;case 39:case 68:e.currentSnakeMoveDirection=MoveDirection.RIGHT;break;case 40:case 83:e.currentSnakeMoveDirection=MoveDirection.DOWN;break;case 37:case 65:e.currentSnakeMoveDirection=MoveDirection.LEFT;break;case 32:e.restart()}e.addChild(e.snake),clearTimeout(t),t=setTimeout(function(){e.speedControlThreshold=0},300)},!1),document.body.addEventListener("keyup",function(i){e.speedControlThreshold=5,clearTimeout(t)},!1)},t.prototype.snakeGo=function(){if(!this.isSnakeDead){if(this.hitWallTest()||this.hitSnakeSelfTest())return void this.gameOver();this.removeChild(this.snake),this.hitBugTest(this.bug)&&(this.snake.eat({x:this.bug.x,y:this.bug.y}),this.randomGenerateFood()),this.snake.autoMove(this.currentSnakeMoveDirection),this.addChild(this.snake)}},t.prototype.hitBugTest=function(e){return this.snake.head.hitTestPoint(e.x+1,e.y+1)||this.snake.head.hitTestPoint(e.x+e.width-1,e.y+1)||this.snake.head.hitTestPoint(e.x+1,e.y+e.height-1)||this.snake.head.hitTestPoint(e.x+e.width-1,e.y+e.height-1)},t.prototype.hitWallTest=function(){return this.snake.head.x<=0||this.snake.head.y<=0||this.snake.head.x>=this.canvasWidth||this.snake.head.y>=this.canvasHeight?!0:!1},t.prototype.hitSnakeSelfTest=function(){var e=this.snake.head,t=e.x,i=e.y,n={x:t,y:i},o=this.snake.bodyData.slice(),s=!1;return o.shift(),o.forEach(function(e,t){var i=e.x,o=e.y;i===n.x&&o===n.y&&(s=!0)}),s},t.prototype.gameOver=function(){this.snake.goDie(),this.isSnakeDead||(this.isSnakeDead=!0,this.addDieWindow(function(){egret.ticker.pause()}))},t.prototype.restart=function(){this.isSnakeDead&&(this.isSnakeDead=!1,this.currentSnakeMoveDirection=MoveDirection.UP,this.speedControlThreshold=5,this.stage.removeChild(this.dieWindow),this.snake.rebirth(),this.addChild(this.snake),this.randomGenerateFood(),this.resetDieWindow(),egret.ticker.resume())},t.prototype.generateDieWindow=function(){var e=300,t=200;this.dieWindow=new Popup(this.canvasWidth,this.canvasHeight),this.resetDieWindow(),this.dieWindow.generate(e,t,!0);var i=new egret.TextField;i.text="You Die!!!",i.fontFamily="Menlo",i.x=e-i.textWidth>>1,i.y=t-i.textHeight>>1,this.dieWindow.addChild(i)},t.prototype.resetDieWindow=function(){this.dieWindow.scaleX=0,this.dieWindow.scaleY=0},t.prototype.addDieWindow=function(e){this.stage.addChild(this.dieWindow),egret.Tween.get(this.dieWindow).to({scaleX:1,scaleY:1},600,egret.Ease.elasticOut).call(e)},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Popup=function(e){function t(t,i){var n=e.call(this)||this;return n.stageWidth=t,n.stageHeight=i,n}return __extends(t,e),t.prototype.generate=function(e,t,i){void 0===i&&(i=!1),this.x=this.stageWidth-e>>1,this.y=this.stageHeight-t>>1,i&&(this.anchorOffsetX=e>>1,this.anchorOffsetY=t>>1,this.x=this.stageWidth>>1,this.y=this.stageHeight>>1),this.graphics.beginFill(16777215,.6),this.graphics.lineStyle(4,16777215),this.graphics.drawRect(0,0,e,t),this.graphics.endFill()},t}(egret.Sprite);__reflect(Popup.prototype,"Popup");var Snake=function(e){function t(t){void 0===t&&(t=16777215);var i=e.call(this)||this;return i.bodyData=snakeBodyData.slice(),i.size=12,i.currentMoveDirection=MoveDirection.UP,i.color=t,i.generate(i.bodyData),i}return __extends(t,e),t.prototype.generate=function(e){this.removeChildren();for(var t=e.length,i=0;t>i;i++){var n=this.drawNode(e[i]);0===i&&(this.head=n)}},t.prototype.goDie=function(){this.autoMove(this.currentMoveDirection,!0)},t.prototype.rebirth=function(){this.currentMoveDirection=MoveDirection.UP,this.bodyData=snakeBodyData.slice(),this.generate(this.bodyData)},t.prototype.eat=function(e){this.bodyData.unshift(e)},t.prototype.autoMove=function(e,t){void 0===t&&(t=!1),t||(this.currentMoveDirection===MoveDirection.LEFT&&e===MoveDirection.RIGHT&&(e=MoveDirection.LEFT),this.currentMoveDirection===MoveDirection.RIGHT&&e===MoveDirection.LEFT&&(e=MoveDirection.RIGHT),this.currentMoveDirection===MoveDirection.DOWN&&e===MoveDirection.UP&&(e=MoveDirection.DOWN),this.currentMoveDirection===MoveDirection.UP&&e===MoveDirection.DOWN&&(e=MoveDirection.UP),this.handleMove(e))},t.prototype.handleMove=function(e){var t=Object.assign({},this.bodyData[0]);switch(this.currentMoveDirection=e,e){case"UP":t.y-=12;break;case"RIGHT":t.x+=12;break;case"DOWN":t.y+=12;break;case"LEFT":t.x-=12}this.bodyData.unshift(t),this.bodyData.pop(),this.generate(this.bodyData)},t.prototype.drawNode=function(e){var t=new egret.Shape;return t.x=e.x,t.y=e.y,t.graphics.beginFill(this.color),t.graphics.drawRect(0,0,this.size,this.size),t.graphics.endFill(),this.addChild(t),t},t}(egret.Sprite);__reflect(Snake.prototype,"Snake");var MoveDirection;!function(e){e.UP="UP",e.RIGHT="RIGHT",e.DOWN="DOWN",e.LEFT="LEFT"}(MoveDirection||(MoveDirection={}));var snakeBodyData=[{x:312,y:1056},{x:312,y:1068},{x:312,y:1080},{x:312,y:1092},{x:312,y:1104},{x:312,y:1116}];